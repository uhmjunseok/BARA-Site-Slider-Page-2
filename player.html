<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>MICROCOSM Player</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<style>
:root{--vh:1vh}
html,body{margin:0;height:100%;background:transparent;overflow:hidden}
.app{height:calc(var(--vh)*100)}
.swiper{height:100%}
.swiper-wrapper{height:100%}
.swiper-slide{height:50%!important;display:flex;align-items:center;justify-content:center}
.frame{position:relative;height:100%;width:100%;cursor:pointer;overflow:hidden;background:transparent}
.thumb{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;object-position:center;display:block}
.play{position:absolute;inset:0;margin:auto;width:0;height:0;border-top:18px solid transparent;border-bottom:18px solid transparent;border-left:30px solid #fff;pointer-events:none;opacity:.9;z-index:6}
.frame iframe{position:absolute;inset:0;width:100%;height:100%;border:0;background:#000;z-index:5}
.frame.is-playing .thumb,.frame.is-playing .play{opacity:0}
</style>
</head>
<body>
<div class="app">
  <div class="swiper" id="baraSwiper">
    <div class="swiper-wrapper">

      <div class="swiper-slide">
        <div class="frame"
          data-video="DRPC2Ba7i7E"
          data-thumb="https://res.cloudinary.com/dlzutetki/image/upload/v1765739880/MICROCOSM_I_RHYTHM_%EB%B3%B5%EC%82%AC_sfdoka.jpg">
          <img class="thumb" src="https://res.cloudinary.com/dlzutetki/image/upload/v1765739880/MICROCOSM_I_RHYTHM_%EB%B3%B5%EC%82%AC_sfdoka.jpg" alt="">
          <div class="play"></div>
        </div>
      </div>

      <div class="swiper-slide">
        <div class="frame"
          data-video="Rp0HBSVz4hg"
          data-thumb="https://res.cloudinary.com/dlzutetki/image/upload/v1765739848/MICROCOSM_I_RHYTHM_Web_vr_%EB%B3%B5%EC%82%AC_zai26j.jpg">
          <img class="thumb" src="https://res.cloudinary.com/dlzutetki/image/upload/v1765739848/MICROCOSM_I_RHYTHM_Web_vr_%EB%B3%B5%EC%82%AC_zai26j.jpg" alt="">
          <div class="play"></div>
        </div>
      </div>

      <div class="swiper-slide">
        <div class="frame"
          data-video="EBvlq_t6CHA"
          data-thumb="https://res.cloudinary.com/dlzutetki/image/upload/v1765739868/MICROCOSM_III_SPREAD_Web_vr_%EB%B3%B5%EC%82%AC_vqxm6c.jpg">
          <img class="thumb" src="https://res.cloudinary.com/dlzutetki/image/upload/v1765739868/MICROCOSM_III_SPREAD_Web_vr_%EB%B3%B5%EC%82%AC_vqxm6c.jpg" alt="">
          <div class="play"></div>
        </div>
      </div>

      <div class="swiper-slide">
        <div class="frame"
          data-video="TldWk1-rzIA"
          data-thumb="https://res.cloudinary.com/dlzutetki/image/upload/v1765739919/Sequence_01_1_%EB%B3%B5%EC%82%AC2_n6jsnn.jpg">
          <img class="thumb" src="https://res.cloudinary.com/dlzutetki/image/upload/v1765739919/Sequence_01_1_%EB%B3%B5%EC%82%AC2_n6jsnn.jpg" alt="">
          <div class="play"></div>
        </div>
      </div>

    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
(function(){
  function setVH(){
    var h = (window.visualViewport && window.visualViewport.height)
      ? window.visualViewport.height
      : window.innerHeight;
    document.documentElement.style.setProperty('--vh', (h * 0.01) + 'px');
  }
  setVH();
  window.addEventListener('resize', setVH);

  var swiper = new Swiper('#baraSwiper', {
    direction:'vertical',
    slidesPerView:2,
    spaceBetween:0,
    resistanceRatio:0,
    threshold:8,
    longSwipesRatio:0.15,
    nested:true,
    watchOverflow:false
  });

  var frames = Array.from(document.querySelectorAll('.frame'));

  function stopOthers(active){
    frames.forEach(function(f){
      if (f !== active && f.classList.contains('is-playing')){
        f.classList.remove('is-playing');
        f.querySelectorAll('iframe').forEach(function(x){ x.remove(); });
      }
    });
  }

  function notify(videoId){
    var msg = { type:'BARA_VIDEO_SELECT', videoId: videoId };
    try { window.top.postMessage(msg, '*'); } catch(e) {}
  }

  frames.forEach(function(f){
    f.addEventListener('click', function(){
      if (f.classList.contains('is-playing')) return;

      var id = f.dataset.video;
      stopOthers(f);

      var i = document.createElement('iframe');
      i.src = 'https://www.youtube.com/embed/' + id + '?autoplay=1&playsinline=1&rel=0';
      i.allow = 'autoplay; encrypted-media; picture-in-picture';
      i.allowFullscreen = true;

      f.appendChild(i);
      f.classList.add('is-playing');
      notify(id);
    });
  });

  swiper.on('slideChange', function(){
    var f = swiper.slides[swiper.activeIndex] && swiper.slides[swiper.activeIndex].querySelector('.frame');
    if (f) notify(f.dataset.video);
  });

  // 초기 선택값(첫 슬라이드)
  var first = frames[0];
  if (first) notify(first.dataset.video);
})();
</script>
</body>
</html>

