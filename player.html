<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>MICROCOSM Player</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">

<style>
html,body{
  margin:0;
  height:100%;
  background:transparent;
  overflow:hidden;
}
:root{ --bara-border: rgba(0,0,0,.12); }

.bara{
  width:100%;
  height:100%;
  background:transparent;
  overflow:hidden;
}

.swiper{
  width:100%;
  height:100%;
}

.swiper-wrapper{ height:100%; }

.swiper-slide{
  height:50%;                 /* 한 화면에 2개 */
  display:flex;
  align-items:center;
  justify-content:center;
}

.frame{
  width:100%;
  height:100%;
  position:relative;
  overflow:hidden;
  cursor:pointer;
  background:transparent;
}

.frame::after{
  content:"";
  position:absolute;
  inset:0;
  border:1px solid var(--bara-border);
  pointer-events:none;
  box-sizing:border-box;
}

.thumb{
  width:100%;
  height:100%;
  object-fit:cover;
  object-position:center;
  display:block;
}

.play{
  position:absolute;
  inset:0;
  margin:auto;
  width:0;height:0;
  border-top:18px solid transparent;
  border-bottom:18px solid transparent;
  border-left:30px solid #fff;
  pointer-events:none;
  z-index:6;
}

.frame iframe{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:0;
  background:#000;
  z-index:5;
}

.frame.is-playing .thumb,
.frame.is-playing .play{ opacity:0; }
</style>
</head>

<body>
<div class="bara">
  <div class="swiper" id="baraSwiper">
    <div class="swiper-wrapper">

      <!-- MICROCOSM I -->
      <div class="swiper-slide">
        <div class="frame"
          data-video="DRPC2Ba7i7E"
          data-thumb="https://res.cloudinary.com/dlzutetki/image/upload/v1765739880/MICROCOSM_I_RHYTHM_%EB%B3%B5%EC%82%AC_sfdoka.jpg">
          <img class="thumb" src="https://res.cloudinary.com/dlzutetki/image/upload/v1765739880/MICROCOSM_I_RHYTHM_%EB%B3%B5%EC%82%AC_sfdoka.jpg">
          <div class="play"></div>
        </div>
      </div>

      <!-- MICROCOSM II -->
      <div class="swiper-slide">
        <div class="frame"
          data-video="Rp0HBSVz4hg"
          data-thumb="https://res.cloudinary.com/dlzutetki/image/upload/v1765739848/MICROCOSM_I_RHYTHM_Web_vr_%EB%B3%B5%EC%82%AC_zai26j.jpg">
          <img class="thumb" src="https://res.cloudinary.com/dlzutetki/image/upload/v1765739848/MICROCOSM_I_RHYTHM_Web_vr_%EB%B3%B5%EC%82%AC_zai26j.jpg">
          <div class="play"></div>
        </div>
      </div>

      <!-- MICROCOSM III -->
      <div class="swiper-slide">
        <div class="frame"
          data-video="EBvlq_t6CHA"
          data-thumb="https://res.cloudinary.com/dlzutetki/image/upload/v1765739868/MICROCOSM_III_SPREAD_Web_vr_%EB%B3%B5%EC%82%AC_vqxm6c.jpg">
          <img class="thumb" src="https://res.cloudinary.com/dlzutetki/image/upload/v1765739868/MICROCOSM_III_SPREAD_Web_vr_%EB%B3%B5%EC%82%AC_vqxm6c.jpg">
          <div class="play"></div>
        </div>
      </div>

      <!-- MICROCOSM IV -->
      <div class="swiper-slide">
        <div class="frame"
          data-video="TldWk1-rzIA"
          data-thumb="https://res.cloudinary.com/dlzutetki/image/upload/v1765739919/Sequence_01_1_%EB%B3%B5%EC%82%AC2_n6jsnn.jpg">
          <img class="thumb" src="https://res.cloudinary.com/dlzutetki/image/upload/v1765739919/Sequence_01_1_%EB%B3%B5%EC%82%AC2_n6jsnn.jpg">
          <div class="play"></div>
        </div>
      </div>

    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
(function(){
  const swiper = new Swiper('#baraSwiper', {
    direction:'vertical',
    slidesPerView:2,
    spaceBetween:0,
    resistanceRatio:0,
    threshold:8,
    longSwipesRatio:0.15,
    nested:true,
    watchOverflow:false
  });

  function restore(frame){
    frame.classList.remove('is-playing');
    frame.innerHTML =
      `<img class="thumb" src="${frame.dataset.thumb}">
       <div class="play"></div>`;
  }

  function stopOthers(active){
    document.querySelectorAll('.frame').forEach(f=>{
      if (f !== active && f.querySelector('iframe')) restore(f);
    });
  }

  function play(frame){
    if (frame.querySelector('iframe')) return;
    stopOthers(frame);
    frame.classList.add('is-playing');
    frame.insertAdjacentHTML('beforeend', `
      <iframe
        src="https://www.youtube.com/embed/${frame.dataset.video}?autoplay=1&playsinline=1&rel=0"
        allow="autoplay; encrypted-media; picture-in-picture; fullscreen"
        allowfullscreen>
      </iframe>
    `);
  }

  function notify(videoId){
    const msg = { type:'BARA_VIDEO_SELECT', videoId };
    try { window.top.postMessage(msg, '*'); } catch(e){}
  }

  document.addEventListener('click', function(e){
    const frame = e.target.closest('.frame');
    if (!frame) return;
    play(frame);
    notify(frame.dataset.video);
  }, true);
})();
</script>
</body>
</html>